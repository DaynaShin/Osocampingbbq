<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í…ŒìŠ¤íŠ¸ìš© ì˜ˆì•½ ìƒì„±</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 50px auto; padding: 20px; }
        .form-group { margin: 15px 0; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select, textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        button { padding: 12px 24px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; margin: 10px 5px; }
        button:hover { background: #0056b3; }
        .log { background: #f8f9fa; padding: 15px; border-radius: 4px; margin: 20px 0; font-family: monospace; white-space: pre-wrap; }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .info { color: #007bff; }
        .existing-reservations { background: #e7f3ff; padding: 15px; border-radius: 4px; margin: 20px 0; }
    </style>
</head>
<body>
    <h1>ğŸ¯ í…ŒìŠ¤íŠ¸ìš© ì˜ˆì•½ ìƒì„± ë° ê´€ë¦¬</h1>
    
    <!-- ê¸°ì¡´ ì˜ˆì•½ ì¡°íšŒ -->
    <div class="existing-reservations">
        <h3>ğŸ“‹ ê¸°ì¡´ ì˜ˆì•½ í˜„í™©</h3>
        <button onclick="loadExistingReservations()">ê¸°ì¡´ ì˜ˆì•½ ì¡°íšŒ</button>
        <div id="reservationsList"></div>
    </div>
    
    <!-- í…ŒìŠ¤íŠ¸ ì˜ˆì•½ ìƒì„± í¼ -->
    <h3>â• ìƒˆ í…ŒìŠ¤íŠ¸ ì˜ˆì•½ ìƒì„±</h3>
    <form id="reservationForm">
        <div class="form-group">
            <label for="customerName">ê³ ê°ëª…</label>
            <input type="text" id="customerName" value="í™ê¸¸ë™" required>
        </div>
        
        <div class="form-group">
            <label for="customerPhone">ì „í™”ë²ˆí˜¸</label>
            <input type="tel" id="customerPhone" value="010-1234-5678" required>
        </div>
        
        <div class="form-group">
            <label for="customerEmail">ì´ë©”ì¼</label>
            <input type="email" id="customerEmail" value="test@example.com">
        </div>
        
        <div class="form-group">
            <label for="reservationDate">ì˜ˆì•½ ë‚ ì§œ</label>
            <input type="date" id="reservationDate" required>
        </div>
        
        <div class="form-group">
            <label for="reservationTime">ì˜ˆì•½ ì‹œê°„</label>
            <select id="reservationTime" required>
                <option value="10:00">10:00</option>
                <option value="11:00">11:00</option>
                <option value="12:00">12:00</option>
                <option value="13:00">13:00</option>
                <option value="14:00">14:00</option>
                <option value="15:00">15:00</option>
                <option value="16:00">16:00</option>
                <option value="17:00">17:00</option>
                <option value="18:00">18:00</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="guestCount">ì¸ì›ìˆ˜</label>
            <input type="number" id="guestCount" value="4" min="1" max="20">
        </div>
        
        <div class="form-group">
            <label for="serviceType">ì„œë¹„ìŠ¤ íƒ€ì…</label>
            <select id="serviceType">
                <option value="camping">ìº í•‘</option>
                <option value="bbq">ë°”ë² í</option>
                <option value="camping_bbq">ìº í•‘+ë°”ë² í</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="message">ìš”ì²­ì‚¬í•­</label>
            <textarea id="message" rows="3" placeholder="íŠ¹ë³„ ìš”ì²­ì‚¬í•­ì´ ìˆìœ¼ì‹œë©´ ì…ë ¥í•´ì£¼ì„¸ìš”"></textarea>
        </div>
        
        <button type="button" onclick="createTestReservation()">ğŸ¯ í…ŒìŠ¤íŠ¸ ì˜ˆì•½ ìƒì„±</button>
        <button type="button" onclick="createMultipleReservations()">ğŸ“Š ì—¬ëŸ¬ í…ŒìŠ¤íŠ¸ ì˜ˆì•½ ìƒì„± (5ê°œ)</button>
    </form>
    
    <div id="log" class="log"></div>

    <!-- ìŠ¤í¬ë¦½íŠ¸ -->
    <script src="env.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="supabase-config-v2.js"></script>
    
    <script>
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : 'info';
            logDiv.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        async function loadExistingReservations() {
            try {
                log('ê¸°ì¡´ ì˜ˆì•½ ì¡°íšŒ ì¤‘...', 'info');
                
                const { data, error } = await supabaseClient
                    .from('reservations')
                    .select('id, name, phone, reservation_date, reservation_time, status, created_at')
                    .order('created_at', { ascending: false })
                    .limit(10);
                
                if (error) {
                    log(`âŒ ì˜ˆì•½ ì¡°íšŒ ì‹¤íŒ¨: ${error.message}`, 'error');
                    return;
                }
                
                const listDiv = document.getElementById('reservationsList');
                if (data && data.length > 0) {
                    log(`âœ… ${data.length}ê°œì˜ ì˜ˆì•½ì„ ì°¾ì•˜ìŠµë‹ˆë‹¤.`, 'success');
                    listDiv.innerHTML = `
                        <h4>ğŸ“‹ ê¸°ì¡´ ì˜ˆì•½ ëª©ë¡:</h4>
                        <ul>
                            ${data.map(r => `
                                <li>
                                    <strong>ID: ${r.id}</strong> - ${r.name} 
                                    (${r.reservation_date} ${r.reservation_time}) 
                                    [${r.status}]
                                </li>
                            `).join('')}
                        </ul>
                        <p><strong>ğŸ’¡ í…ŒìŠ¤íŠ¸ íŒ:</strong> ìœ„ ID ì¤‘ í•˜ë‚˜ë¥¼ ê³¨ë¼ ê´€ë¦¬ì í…ŒìŠ¤íŠ¸ì— ì‚¬ìš©í•˜ì„¸ìš”!</p>
                    `;
                } else {
                    log('ğŸ“ ê¸°ì¡´ ì˜ˆì•½ì´ ì—†ìŠµë‹ˆë‹¤. ìƒˆ ì˜ˆì•½ì„ ìƒì„±í•˜ì„¸ìš”.', 'info');
                    listDiv.innerHTML = '<p>ğŸ“ ê¸°ì¡´ ì˜ˆì•½ì´ ì—†ìŠµë‹ˆë‹¤. ì•„ë˜ì—ì„œ í…ŒìŠ¤íŠ¸ ì˜ˆì•½ì„ ìƒì„±í•˜ì„¸ìš”.</p>';
                }
            } catch (error) {
                log(`ğŸ’¥ ì˜ˆì•½ ì¡°íšŒ ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }
        
        async function createTestReservation() {
            try {
                const reservationData = {
                    customer_name: document.getElementById('customerName').value,
                    customer_phone: document.getElementById('customerPhone').value,
                    customer_email: document.getElementById('customerEmail').value,
                    reservation_date: document.getElementById('reservationDate').value,
                    reservation_time: document.getElementById('reservationTime').value,
                    guest_count: parseInt(document.getElementById('guestCount').value),
                    service_type: document.getElementById('serviceType').value,
                    message: document.getElementById('message').value
                };
                
                log('í…ŒìŠ¤íŠ¸ ì˜ˆì•½ ìƒì„± ì¤‘...', 'info');
                log(`ì˜ˆì•½ ì •ë³´: ${JSON.stringify(reservationData, null, 2)}`, 'info');
                
                const result = await createReservation({
                    name: reservationData.customer_name,
                    phone: reservationData.customer_phone,
                    email: reservationData.customer_email,
                    reservation_date: reservationData.reservation_date,
                    reservation_time: reservationData.reservation_time,
                    guest_count: reservationData.guest_count,
                    service_type: reservationData.service_type,
                    message: reservationData.message
                });
                
                if (result.success) {
                    log(`âœ… í…ŒìŠ¤íŠ¸ ì˜ˆì•½ ìƒì„± ì„±ê³µ!`, 'success');
                    log(`ğŸ“‹ ì˜ˆì•½ ID: ${result.data.id}`, 'success');
                    log(`ğŸ« ì˜ˆì•½ ë²ˆí˜¸: ${result.data.reservation_number}`, 'success');
                    log('ğŸ’¡ ì´ ì˜ˆì•½ IDë¥¼ ê´€ë¦¬ì í…ŒìŠ¤íŠ¸ì— ì‚¬ìš©í•˜ì„¸ìš”!', 'info');
                    
                    // ìƒì„± í›„ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                    setTimeout(loadExistingReservations, 1000);
                } else {
                    log(`âŒ ì˜ˆì•½ ìƒì„± ì‹¤íŒ¨: ${result.error}`, 'error');
                }
            } catch (error) {
                log(`ğŸ’¥ ì˜ˆì•½ ìƒì„± ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }
        
        async function createMultipleReservations() {
            const testReservations = [
                { name: 'ê¹€ì² ìˆ˜', phone: '010-1111-1111', service: 'camping', guests: 2 },
                { name: 'ì´ì˜í¬', phone: '010-2222-2222', service: 'bbq', guests: 4 },
                { name: 'ë°•ë¯¼ìˆ˜', phone: '010-3333-3333', service: 'camping_bbq', guests: 6 },
                { name: 'ì •ìˆ˜ì§„', phone: '010-4444-4444', service: 'camping', guests: 3 },
                { name: 'ìµœë‹¤í˜œ', phone: '010-5555-5555', service: 'bbq', guests: 5 }
            ];
            
            const baseDate = new Date();
            baseDate.setDate(baseDate.getDate() + 1); // ë‚´ì¼ ë‚ ì§œ
            
            log('ì—¬ëŸ¬ í…ŒìŠ¤íŠ¸ ì˜ˆì•½ ìƒì„± ì¤‘...', 'info');
            
            for (let i = 0; i < testReservations.length; i++) {
                const testData = testReservations[i];
                const reservationDate = new Date(baseDate);
                reservationDate.setDate(reservationDate.getDate() + i);
                
                try {
                    const result = await createReservation({
                        name: testData.name,
                        phone: testData.phone,
                        email: `${testData.name.toLowerCase()}@test.com`,
                        reservation_date: reservationDate.toISOString().split('T')[0],
                        reservation_time: `${12 + i}:00`,
                        guest_count: testData.guests,
                        service_type: testData.service,
                        message: `í…ŒìŠ¤íŠ¸ ì˜ˆì•½ ${i + 1}`
                    });
                    
                    if (result.success) {
                        log(`âœ… ${testData.name} ì˜ˆì•½ ìƒì„± ì„±ê³µ (ID: ${result.data.id})`, 'success');
                    } else {
                        log(`âŒ ${testData.name} ì˜ˆì•½ ìƒì„± ì‹¤íŒ¨: ${result.error}`, 'error');
                    }
                    
                    // ìš”ì²­ ê°„ ê°„ê²©
                    await new Promise(resolve => setTimeout(resolve, 500));
                } catch (error) {
                    log(`ğŸ’¥ ${testData.name} ì˜ˆì•½ ìƒì„± ì˜¤ë¥˜: ${error.message}`, 'error');
                }
            }
            
            log('ğŸ‰ ì—¬ëŸ¬ í…ŒìŠ¤íŠ¸ ì˜ˆì•½ ìƒì„± ì™„ë£Œ!', 'success');
            setTimeout(loadExistingReservations, 2000);
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.onload = function() {
            // ë‚´ì¼ ë‚ ì§œë¡œ ê¸°ë³¸ê°’ ì„¤ì •
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            document.getElementById('reservationDate').value = tomorrow.toISOString().split('T')[0];
            
            // ê¸°ì¡´ ì˜ˆì•½ ìë™ ì¡°íšŒ
            loadExistingReservations();
            
            log('ğŸ¯ í…ŒìŠ¤íŠ¸ìš© ì˜ˆì•½ ìƒì„± ë„êµ¬ê°€ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
        };
    </script>
</body>
</html>